
<html>
	<head>
        <meta charset="utf-8">
		<link rel="stylesheet" href="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/css/ol.css">
		<style>
	      .map {
	        height: 700px;
	        width: 1000px;
	      }
	    </style>
	    <script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/build/ol.js"></script>
	    <title>OpenLayers example</title>
    </head>	
	  <body>
          <h1>Pruebas con OpenLayer</h1>
          <p>
            Pruebas con mapas utilizando la API de OpenLayer.
          </p>
          <h2>Volta del general</h2>
          <p>
            Itinerario de la excursión que parte del parking que hay antes de llegar a
            Banyalbufar, donde se dejará el coche. Al final de un camino de tierra,
            se enlaza con la carretera a la altura de la posesión de Son Bunyola.
              
            Terminamos la excursión en la platja de Son Bunyola, poco antes de llegar
            al Port des Canonge.
          </p>
	    <div id="map" class="map"></div>

          <h2>Mapa general de Mallorca</h2>
          <p>
            Excursiones de mallorca
          </p>
          
          
        <div id="mapaMallorca" class="map"></div> 


        <button id="pal-to-cami_des_correu">Cami des correu</button> 
        <button id="pal-to-volta_des_general">Volta des general</button> 
		<button id="centro_mallorca">Volta des general</button> 
        
	    <script type="text/javascript">


	    	var center_cami_des_correu = ol.proj.fromLonLat([2.5307, 39.6844]);
			var center_volta_des_general = ol.proj.fromLonLat([2.5338, 39.6951]);

			var centro_mallorca = ol.proj.fromLonLat([2.5, 39.6]);
			// primero creamos una view, la centramos y le metemos el zoom que queremos

			var vistaVoltaGeneral = new ol.View({
	        	center: ol.proj.fromLonLat([2.5338, 39.6951]),
	        	zoom: 15
	        });

			// Nuestra capa base será un mapa OSM del mapamundi

			var capa_base = new ol.layer.Tile({
	       		source: new ol.source.OSM()
	    	});

			// Creamos nuestro mapa de excursion y le metemos la capa del mapamundi
            // Este mapa va a caer en el DIV con class capa_base
				
		   	var mapaCorreu = new ol.Map({
		        target: 'map',
		        layers: [ capa_base ],
		        view: vistaVoltaGeneral,
		        loadTilesWhileAnimating: true
		    });
      		
		   	
            // MAPA 2 ---- MAPA GENERAL DE MALLORCA ------- 
            // Creamos nuestro mapa de Mallorca y le metemos la capa del mapamundi
            // Este mapa va a caer en el DIV con class capa_base
            
            var vistaMallorca = new ol.View({
	        	center: ol.proj.fromLonLat([2.7892, 39.6157]),
	        	zoom: 10
	        });
				
		   	var mapaMallorca = new ol.Map({
		        target: 'mapaMallorca',
		        layers: [ capa_base ],
		        view: vistaMallorca
		    });
            
            
            
            // Vamos a crear una segunda capa en la que incluiremos los POIs (point of interest)
		   	// Hay que transformar las coordenadas porque sino no va

		   	var coordinate = ol.proj.transform([2.52145, 39.69000], 'EPSG:4326', 'EPSG:3857');
			var coordinate2 = ol.proj.transform([2.79782, 39.81050], 'EPSG:4326', 'EPSG:3857');
            var massanella = ol.proj.transform([2.8529806, 39.8060306], 'EPSG:4326', 'EPSG:3857');
            
        /*    var tossals
            var tomir
            var alfabia
            var teix
            var galatzo
            var puig roig
            N39 47 2.96 E2 49 13.41
 N39 50 35.53 E2 55 32.51
 N39 44 35.94 E2 43 56.86
 N39 43 52.68 E2 39 40.91
 N39 38 2.17 E2 29 12.01
 N39 51 38.43 E2 51 37.79*/



		   	// Creamos una característica que contenga un punto en donde queremos

		   	var pointFeature 	= new ol.Feature(		   		
		   		new ol.geom.Point(coordinate)
		   	);

			var pointFeature2 	= new ol.Feature(		   		
		   		
		   		new ol.geom.Point(coordinate2)
		   	);
					
            var pointFeature3 	= new ol.Feature(		   		
		   		
		   		new ol.geom.Point(massanella)
		   	);
		 	// Esto es el icono que quería poner como marcador. La cosa es que da problemas
		 	// Al hacer zoom in y out se va donde le da la gana. Lo he cambiado por un círculo. No se llega a usar

			var imagen_refugio = new ol.style.Icon ({
          anchor: [0.5, 0.5],
          anchorXUnits: 'fraction',
          anchorYUnits: 'fraction',
                opacity: 0.95,
                src: 'img/home.png'
            });

            var icono_refugio = new ol.style.Style({
              		image: imagen_refugio,
	            	stroke: trazo,
	              	fill: relleno
            	});

			// Vamos a hacer un circulito con relleno negro y borde blanco
			// Creamos las propiedades

			var relleno = new ol.style.Fill({
	                color: 'rgba(255, 255, 255, 0.6)'
	                });

			var trazo = new ol.style.Stroke({
				width: 3,
				color: [255, 0, 0, 1]
			});

			// Creamos el círculo

			var circulo = new ol.style.Circle({
	            radius: 7,
	            fill: new ol.style.Fill({ color: 'black'}),
	            stroke: new ol.style.Stroke({ color: 'white', width: 2  })
            });

            // Creamos un estilo

			var circulo_negro = new ol.style.Style({
              		image: circulo,
	            	stroke: trazo,
	              	fill: relleno
            	});

			// Creamos un layer y la añadimos al mapa
			
			var vectorSource = new ol.source.Vector({
				features: [ pointFeature,
				pointFeature2,
                pointFeature3
				]
			});



			var capa_verGeo = new ol.layer.Vector({
				source: vectorSource,
				style:  circulo_negro
			});

        
            
            var style = {
                'Point': new ol.style.Style({
                    image: new ol.style.Circle({
                        fill: new ol.style.Fill({
                            color: '#8c2210'
                        }),
                        radius: 5,
                        stroke: new ol.style.Stroke({
                            color: '#000',
                            width: 1
                        })
                    })
                }),
                'LineString': new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: '#f00',
                        width: 3
                    })
                }),
                'MultiLineString': new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: '#f45c42',
                        width: 3
                    })
                })
            };
            
            // Pruebas con mapas KML
            // Por el motivo que sea los KML de Google Earth no los coge bien
            //import KMLSource from 'ol/source/KML';

            var refugios = new ol.layer.Vector({
                source: new ol.source.Vector({
                    //projection: 'EPSG:3857',
                    url: 'kml/refugios.kml',
                    format: new ol.format.KML({
      					extractStyles: false,
      					//showPointNames: true
    				})
                }),
                    style: icono_refugio
            });
            

            var exc_cami_des_correu = new ol.layer.Vector({
                source: new ol.source.Vector({
                    //projection: 'EPSG:3857',
                    url: 'kml/exc_cami_des_correu.kml',
                    format: new ol.format.KML({
      					extractStyles: false,
      					//showPointNames: true
    				})
                }),
                style: function(feature) {
                    return style[feature.getGeometry().getType()];
                }
            });


            
            var exc_port_des_canonge = new ol.layer.Vector({
                source: new ol.source.Vector({
                    url: 'gpx/B4122_015_Canonge.gpx',
                    format: new ol.format.GPX()
                }),
                style: function(feature) {
                    return style[feature.getGeometry().getType()];
                }
            });
            
            
            mapaCorreu.addLayer(exc_port_des_canonge);
            //mapaMallorca.addLayer(capa_verGeo);
            mapaMallorca.addLayer(refugios);
            mapaMallorca.addLayer(exc_cami_des_correu);
            mapaMallorca.addLayer(exc_port_des_canonge);
            
            // Festival de animaciones


            

            function onClick(id, callback) {
        		document.getElementById(id).addEventListener('click', callback);
      		}

			onClick('pal-to-cami_des_correu', function() {
        		
				// Teóricamente esto debería de funcionar y centrar
				// según la zona que ocupe la ruta. La cosa es que no va
				// TO-DO: Arreglar para que funcione
				
				/*

				var vs = new ol.source.Vector({
                    //projection: 'EPSG:3857',
                    url: 'kml/exc_cami_des_correu.kml',
                    format: new ol.format.KML({
      					extractStyles: false,
      					//showPointNames: true
    				})
                })

//				alert(vs.getExtent());

        		mapaMallorca.getView().fit(
        			vs.getExtent(), 
        			{ duration: 1000 }
        		);
        		mapaMallorca.setCenter();
        		*/

			vistaMallorca.animate({
	        		center: center_cami_des_correu,
	        		duration: 2000,
	        		zoom: 14
	        	});
			});

			onClick('pal-to-volta_des_general', function() {
					vistaMallorca.animate({
	        		center: center_volta_des_general,
	        		duration: 2000,
	        		zoom: 15
	        	});
			});
/*
			onClick(centrar_en_ruta, function() {
					vistaMallorca.animate({
	        		center: centrar_en_ruta,
	        		duration: 2000,
	        		zoom: 15
	        	});
			});
*/

	    </script>
	  </body>


</html>

